import numpy as np
import matplotlib.pyplot as plt
import sys

'''
A script tp plot FC activations. 

- Currently this probably works only for 0-dimensional data.
- First command line argument is the FC layer index, further 
  arguments specify which nodes to plot.
'''

# Density of the iteration plots
plot_period=1

Narg = len(sys.argv)

if Narg>1:
    fclayer=int(sys.argv[1])
else:
    print("Which layer?")
plot_true_dist=False
for word in sys.argv:
    if word=="-PV":
        plot_true_dist=True

A0 = np.load('activations_fclayer'+str(fclayer)+'.npy')
B0=np.load('validation.npy') # This is the validation set!
Xdata=B0[0]
Ydata=B0[1]

# Specify which nodes to plot
nodes=[]
if(Narg>2):
    idx=0
    for i in range(3,Narg):
        nodes.append(int(sys.argv[i]))
else:
    nodes=np.arange(len(A0[0,:,0]))


Niter=len(A0)
Nnodes=len(nodes)
plt.ion()
fig,ax=plt.subplots(1)
print(nodes)
for i in range(Niter):
    if(i%plot_period==0):
        ax.clear()
        ax.set_title('Iteration '+str(i)+'/'+str(Niter))
        plt.hold(True)
        for j in range(Nnodes):
            ax.plot(Xdata[:,0],A0[i,nodes[j],:])
        if(plot_true_dist):ax.plot(Xdata[:,0],Ydata[:,0],'r-')
        fig.canvas.draw()
        plt.hold(False)
        plt.pause(0.0002)
    
